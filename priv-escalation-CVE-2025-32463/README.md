# CVE-2025-32463 - Name Service Switch (NSS) inyection

## ðŸ“Œ Summary

Local privilege escalation vulnerability that exists in **sudo versions 1.9.14 < 1.9.17p1**. It allows an unprivileged local user to execute arbitrary code **as root** by abusing the `--chroot` option combined with Linux's **Name Service Switch (NSS)** mechanism.

The vulnerability can be exploit because **sudo evaluates system configuration files (NSS-related) *after* performing a user-controlled `chroot()`**, but *before* privilege checks are fully finalized.

---

## ðŸ§  Root Cause

A behavioral change was introduced in **sudo 1.9.14**:

* `sudo` began resolving paths using `chroot()` **based on a user-supplied directory**
* This occurred **while the sudoers policy was still being evaluated**

This opened a window where an attacker could:

1. Control the filesystem root used by sudo
2. Influence which configuration files and shared libraries sudo loads

Specifically, **NSS (Name Service Switch)** configuration and modules were loaded from the attacker-controlled chroot environment.

---

## ðŸ§¨ Attack Overview

### Prerequisites

* Local unprivileged user
* `sudo` installed version (1.9.14 < 1.9.17p1)

### High-Level Steps

1. **Create a writable directory** (e.g., `sudo.stage.XXXXXX`)
2. Inside it, create a fake `/etc` structure:

   ```
   /etc/nsswitch.conf
   /etc/group
   ```
3. Configure `nsswitch.conf` to load a custom NSS module
4. Place a **malicious `libnss_*.so` shared library** in the appropriate path
5. In this case, the prepared working directory is used as the chroot root

   ```bash
    sudo --chroot=/tmp/sudo.stage.XXXXXX <any-command>
   ```

### What Happens Internally

* `sudo` performs `chroot("/tmp/sudo.stage.XXXXXX")`
* While still running as root, it attempts to resolve users/groups
* NSS reads `/etc/nsswitch.conf` **inside the chroot**
* The malicious `libnss_*.so` is loaded
* The shared object executes attacker-controlled code **with root privileges**

---

## ðŸ§ª Compilation (Proof of Concept)

Compile it with:

```bash
gcc -o exploit exploit.c
```

> The resulting binary can then be used as part of the exploitation process described above.

---
